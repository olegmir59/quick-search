# Employee Directory CLI

## Требования
- Python 3.11 или новее (`python --version`)
- Командная строка (PowerShell, cmd, bash)
- Права на запись в каталог проекта (создаётся база `employees.db` и папка `exports/`)

## Подготовка окружения
- Перейдите в корень проекта: `cd C:\Users\olegm\Desktop\quick-search`
- (Опционально) создайте виртуальное окружение:
  - `python -m venv .venv`
  - PowerShell: `.venv\Scripts\Activate.ps1`
  - cmd: `.venv\Scripts\activate.bat`
  - bash: `source .venv/bin/activate`
- Установка зависимостей не требуется (используются только стандартные библиотеки Python). При необходимости: `pip install -r requirements.txt`

## Общие сведения
- Запуск приложения: `python main.py <режим> [доп.параметры]`
- База данных: SQLite (`employees.db` рядом с `main.py`)
- Кодировка консоли по возможности переключается на UTF-8 автоматически

## Режимы
- `1` — создание таблицы и индексов  
  `python main.py 1`
- `2` — добавление одной записи  
  `python main.py 2 "Mironenko Oleg Georgievich" 1959-12-28 Male`
- `3` — вывод уникальных сотрудников (ФИО+дата), сортировка по ФИО  
  `python main.py 3`
- `4` — генерация 1 000 000 строк + 100 специальных записей, пакетная загрузка  
  `python main.py 4`
- `5` — выборка мужчин с фамилией на `F`, замер времени выполнения  
  `python main.py 5`
- `6` — оптимизация запроса, создание композитного индекса, повторный замер  
  `python main.py 6`
- `7` — использование индексов и сжатия данных (подробности ниже)  
  `python main.py 7 [путь\к\файлу.gz]`
- `8` — создание таблицы со сжатыми данными для ускорения выборки (подробности ниже)  
  `python main.py 8`

## Особенности режима 7
- Убеждается, что создан композитный индекс `ON employees (gender, full_name)` для ускорения фильтрации (`gender='Male'`, `full_name LIKE 'F%'`)
- Выбирает сотрудников, как в режиме 5, и сериализует данные в JSONL формат
- Результат сохраняется в gzip-архив (`exports/male_f.jsonl.gz` по умолчанию или путь из аргумента)
- Для каждой строки записывается `full_name`, `birth_date`, `gender`, `age`
- По завершении выводит:
  - количество записей;
  - оценочный размер несжатых данных;
  - фактический размер архива;
  - процент экономии места;
  - напоминание о задействованном индексе.
- Пример запуска с собственным путём:  
  `python main.py 7 "C:\backup\male_f_subset.gz"`

## Особенности режима 8
- Создаёт дополнительную таблицу `compressed_employees` (формат `WITHOUT ROWID`) и индекс `ON (gender, full_name)` для хранения заранее отфильтрованных записей (`gender='Male'` и фамилия на `F`).
- Каждая запись сериализуется в JSON и сжимается через `gzip`, после чего сохраняется как `BLOB`. В таблице остаются ключевые столбцы (`full_name`, `birth_date`, `gender`) для индексированного поиска.
- При выполнении режима сравниваются:
  - время выборки из основной таблицы;
  - время выборки из компактной таблицы (быстрее за счёт меньшего объёма данных и уже подготовленного индекса);
  - объём несжатых данных vs объём сжатого хранения (экономия в процентах).
- Итоговый вывод показывает количество записей, размер сжатого хранилища, пример восстановленной записи и пояснение про выигрыш:
  - **по памяти** — хранение в сжатом виде снижает суммарное количество байт, необходимых для экспорта/передачи данных;
  - **по скорости** — запрос обходит меньше страниц, так как работает с уже отфильтрованным набором и индексом, а распаковка выполняется в памяти быстрее, чем повторный проход по основной таблице.
- Режим следует запускать после наполнения данных (например, режимом `4`), чтобы увидеть эффект.

## Рекомендованная последовательность проверки
1. Запустите режим `1` для подготовки схемы.
2. При необходимости заполните данные режимом `4`.
3. Убедитесь в корректной работе режимов `5` и `6` и зафиксируйте времена.
4. Выполните режим `7` и проверьте появление файла `exports/male_f.jsonl.gz` либо указанного вами пути.
5. Запустите режим `8`, сравните показатели по скорости и памяти в выводе.
6. Для повторного запуска удалите при необходимости `employees.db`, чтобы начать с чистой базы.

